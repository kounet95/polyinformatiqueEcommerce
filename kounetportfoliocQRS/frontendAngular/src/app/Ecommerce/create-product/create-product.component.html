<form [formGroup]="productForm" (ngSubmit)="onSubmit()" novalidate>
  <mat-form-field appearance="fill" class="w-100 mb-3">
    <mat-label>Nom du produit</mat-label>
    <input matInput formControlName="name" autocomplete="off">
    <mat-error *ngIf="productForm.get('name')?.hasError('required')">
      Nom requis.
    </mat-error>
    <mat-error *ngIf="productForm.get('name')?.hasError('minlength')">
      Au moins 2 caractères.
    </mat-error>
  </mat-form-field>

  <mat-form-field appearance="fill" class="w-100 mb-3">
    <mat-label>Description</mat-label>
    <textarea matInput formControlName="description"></textarea>
    <mat-error *ngIf="productForm.get('description')?.hasError('required')">
      Description requise.
    </mat-error>
  </mat-form-field>

  <mat-form-field appearance="fill" class="w-100 mb-3">
    <mat-label>Catégorie</mat-label>
    <mat-select formControlName="categoryId" required>
      <mat-option *ngFor="let cat of categories" [value]="cat.id">
        {{ cat.name }}
      </mat-option>
    </mat-select>
    <mat-error *ngIf="productForm.get('categoryId')?.invalid && productForm.get('categoryId')?.touched">
      Catégorie requise.
    </mat-error>
  </mat-form-field>

  <mat-form-field appearance="fill" class="w-100 mb-3">
    <mat-label>Sous-catégorie</mat-label>
    <mat-select formControlName="subcategoryId" required>
      <mat-option *ngFor="let sc of sousCategories" [value]="sc.id">
        {{ sc.name }}
      </mat-option>
    </mat-select>
    <mat-error *ngIf="productForm.get('subcategoryId')?.invalid && productForm.get('subcategoryId')?.touched">
      Sous-catégorie requise.
    </mat-error>
  </mat-form-field>

  <mat-form-field appearance="fill" class="w-100 mb-3">
    <mat-label>Groupe social</mat-label>
    <mat-select formControlName="socialGroupId" required>
      <mat-option *ngFor="let sg of categoriesSociales" [value]="sg.id">
        {{ sg.name }}
      </mat-option>
    </mat-select>
    <mat-error *ngIf="productForm.get('socialGroupId')?.invalid && productForm.get('socialGroupId')?.touched">
      Groupe social requis.
    </mat-error>
  </mat-form-field>

  <!-- Taille du produit : affichage simple en liste -->
  <mat-form-field appearance="fill" class="w-100 mb-3">
    <mat-label>Tailles du produit</mat-label>
    <mat-select formControlName="productSizes" multiple>
      <mat-option *ngFor="let size of productSizes" [value]="size">
        {{size.sizeProd}} — {{size.price | number:'1.2-2'}}€
      </mat-option>
    </mat-select>
    <mat-hint>Sélectionne une ou plusieurs tailles</mat-hint>
  </mat-form-field>

  <mat-checkbox formControlName="isActive" class="mb-3">Actif ?</mat-checkbox>

  <mat-form-field appearance="fill" class="w-100 mb-3">
    <mat-label>Couleurs</mat-label>
    <input matInput formControlName="couleurs">
  </mat-form-field>

  <div class="mb-3">
    <label for="file" class="form-label">Image produit</label>
    <input type="file" id="file" (change)="onFileSelected($event)">
  </div>

  <button mat-raised-button color="primary" type="submit" [disabled]="loading">Créer</button>

  <mat-card *ngIf="successMessage" class="mt-3 mat-elevation-z2" color="primary">{{ successMessage }}</mat-card>
  <mat-card *ngIf="errorMessage" class="mt-3 mat-elevation-z2" color="warn">{{ errorMessage }}</mat-card>
</form>