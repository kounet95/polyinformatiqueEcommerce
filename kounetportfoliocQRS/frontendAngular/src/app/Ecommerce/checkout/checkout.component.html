<!-- Titre de la page -->
<div class="page-title light-background">
  <div class="container">
    <nav class="breadcrumbs">
      <ol>
        <li><a routerLink="/">Accueil</a></li>
        <li><a routerLink="/boutique">Boutique</a></li>
        <li><a routerLink="/cart">Panier</a></li>
        <li class="current">Paiement</li>
      </ol>
    </nav>
  </div>
</div>

<app-announcement-bar></app-announcement-bar>

<section id="cart" class="cart section">
  <div class="checkout-container">

    <!-- √âtapes du paiement -->
    <div class="checkout-steps">
      <div class="step" [class.active]="step === 1" [class.completed]="step > 1">
        <span>1</span>
        <div>Informations</div>
      </div>
      <div class="line"></div>
      <div class="step" [class.active]="step === 2" [class.completed]="step > 2">
        <span>2</span>
        <div>Livraison</div>
      </div>
      <div class="line"></div>
      <div class="step" [class.active]="step === 3" [class.completed]="step > 3">
        <span>3</span>
        <div>Paiement</div>
      </div>
      <div class="line"></div>
      <div class="step" [class.active]="step === 4">
        <span>4</span>
        <div>R√©vision</div>
      </div>
    </div>

    <!-- Formulaire principal -->
    <div class="checkout-main">
      <div class="checkout-form">

        <!-- √âtape 1 : Informations client -->
        <div *ngIf="step === 1">
          <h2>Informations client</h2>
          <p class="form-desc">Veuillez entrer vos coordonn√©es</p>
          <form>
            <div class="form-row">
              <input class="form-input" placeholder="Pr√©nom" [(ngModel)]="customer.firstname" name="firstname" required />
              <input class="form-input" placeholder="Nom" [(ngModel)]="customer.lastname" name="lastname" required />
            </div>
            <input class="form-input" placeholder="Votre courriel" [(ngModel)]="customer.email" name="email" required />
            <input class="form-input" placeholder="Votre num√©ro de t√©l√©phone" [(ngModel)]="customer.phone" name="phone" />
            <button type="button" class="btn main-btn" (click)="nextStep()"
              [disabled]="!customer.firstname || !customer.lastname || !customer.email">
              Continuer vers la livraison
            </button>
          </form>
        </div>

        <!-- √âtape 2 : Adresse de livraison -->
        <div *ngIf="step === 2">
          <h2>Adresse de livraison</h2>
          <p class="form-desc">O√π souhaitez-vous que nous livrions votre commande ?</p>
          <form>
            <input class="form-input" placeholder="Adresse" [(ngModel)]="shippingAddress.street" name="street" required />
            <input class="form-input" placeholder="Appartement, suite, etc. (optionnel)" [(ngModel)]="shippingAddress.apartment" name="apartment" />
            <div class="form-row">
              <input class="form-input" placeholder="Ville" [(ngModel)]="shippingAddress.city" name="city" required />
              <input class="form-input" placeholder="√âtat / Province" [(ngModel)]="shippingAddress.state" name="state" />
              <input class="form-input" placeholder="Code postal" [(ngModel)]="shippingAddress.zip" name="zip" required />
            </div>
            <select class="form-input" [(ngModel)]="shippingAddress.country" name="country" required>
              <option value="">S√©lectionner un pays</option>
              <option value="France">France</option>
              <option value="USA">√âtats-Unis</option>
              <!-- Ajouter d'autres pays ici -->
            </select>
            <div class="form-actions">
              <button type="button" class="btn secondary-btn" (click)="prevStep()">Retour</button>
              <button type="button" class="btn main-btn" (click)="nextStep()"
                [disabled]="!shippingAddress.street || !shippingAddress.city || !shippingAddress.zip || !shippingAddress.country">
                Continuer vers le paiement
              </button>
            </div>
          </form>
        </div>

        <!-- √âtape 3 : M√©thode de paiement -->
        <div *ngIf="step === 3">
          <h2>M√©thode de paiement</h2>
          <p class="form-desc">Choisissez votre m√©thode de paiement</p>
          <form>
            <div class="payment-options">
              <label>
                <input type="radio" [(ngModel)]="payment.method" value="card" name="paymethod" /> Carte bancaire
              </label>
              <label>
                <input type="radio" [(ngModel)]="payment.method" value="paypal" name="paymethod" /> PayPal
              </label>
              <label>
                <input type="radio" [(ngModel)]="payment.method" value="applepay" name="paymethod" /> Apple Pay
              </label>
            </div>
            <div *ngIf="payment.method === 'card'" class="card-form">
              <input class="form-input" placeholder="Num√©ro de carte" [(ngModel)]="payment.cardNumber" name="cardNumber" />
              <div class="form-row">
                <input class="form-input" placeholder="Date d‚Äôexpiration" [(ngModel)]="payment.exp" name="exp" />
                <input class="form-input" placeholder="CVV" [(ngModel)]="payment.cvv" name="cvv" />
              </div>
              <input class="form-input" placeholder="Nom sur la carte" [(ngModel)]="payment.name" name="name" />
            </div>
            <div class="form-actions">
              <button type="button" class="btn secondary-btn" (click)="prevStep()">Retour</button>
              <button type="button" class="btn main-btn" (click)="nextStep()">V√©rifier la commande</button>
            </div>
          </form>
        </div>

        <!-- √âtape 4 : V√©rification finale -->
        <div *ngIf="step === 4">
          <h2>V√©rification de la commande</h2>
          <p class="form-desc">Merci de v√©rifier vos informations avant de passer la commande</p>
          <div class="review-block">
            <div class="review-section">
              <h4>Informations de contact <a (click)="step=1">Modifier</a></h4>
              <div>{{ customer.firstname }} {{ customer.lastname }}</div>
              <div>{{ customer.email }}</div>
              <div>{{ customer.phone }}</div>
            </div>
            <div class="review-section">
              <h4>Adresse de livraison <a (click)="step=2">Modifier</a></h4>
              <div>{{ shippingAddress.street }} {{ shippingAddress.apartment }}</div>
              <div>{{ shippingAddress.city }}, {{ shippingAddress.state }} {{ shippingAddress.zip }}</div>
              <div>{{ shippingAddress.country }}</div>
            </div>
            <div class="review-section">
              <h4>M√©thode de paiement <a (click)="step=3">Modifier</a></h4>
              <div *ngIf="payment.method==='card'">Carte se terminant par {{ payment.cardNumber?.slice(-4) }}</div>
              <div *ngIf="payment.method==='paypal'">PayPal</div>
              <div *ngIf="payment.method==='applepay'">Apple Pay</div>
            </div>
          </div>
          <div class="form-actions">
            <button type="button" class="btn secondary-btn" (click)="prevStep()">Retour</button>
            <button type="button" class="btn main-btn" (click)="placeOrder()">Passer la commande</button>
          </div>
          <div *ngIf="message" class="alert alert-success mt-3">{{message}}</div>
        </div>

      </div>

      <!-- R√©sum√© de la commande -->
      <aside class="order-summary">
        <h3>R√©sum√© de la commande</h3>
        <div *ngFor="let item of cartItems" class="summary-item">
          <img [src]="item.productImg" width="60" height="60" />
          <div class="summary-details">
            <div class="summary-title">{{item.productName}}</div>
            <div class="summary-meta">Taille : {{item.productSize}}</div>
            <div class="summary-meta">{{item.qty}} √ó ${{ item.pricePromo ?? item.productSizePrice | number:'1.2-2' }}</div>
          </div>
        </div>
        <hr>
        <div class="summary-row"><span>Sous-total</span><span>${{ subtotal | number:'1.2-2' }}</span></div>
        <div class="summary-row"><span>Livraison</span><span>${{ shipping | number:'1.2-2' }}</span></div>
        <div class="summary-row"><span>Taxe</span><span>${{ tax | number:'1.2-2' }}</span></div>
        <div class="summary-row total"><span>Total</span><span>${{ total | number:'1.2-2' }}</span></div>
        <div class="promo-row">
          <input class="promo-input" placeholder="Code promo" [(ngModel)]="promoCode" />
          <button class="btn promo-btn" (click)="applyPromo()">Appliquer</button>
        </div>
        <div class="secure-checkout">
          <span class="secure-icon">üîí</span> Paiement s√©curis√©
          <div class="payment-icons">
            <i class="material-icons">credit_card</i>
            <i class="material-icons">payment</i>
            <i class="material-icons">account_balance</i>
            <i class="material-icons">account_balance_wallet</i>
          </div>
        </div>
      </aside>
    </div>
  </div>
</section>
