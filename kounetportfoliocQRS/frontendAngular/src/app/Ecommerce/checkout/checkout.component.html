<div class="checkout-container">
  <!-- STEPPER -->
  <div class="checkout-steps">
    <div class="step" [class.active]="step === 1" [class.completed]="step > 1">
      <span>1</span>
      <div>Information</div>
    </div>
    <div class="line"></div>
    <div class="step" [class.active]="step === 2" [class.completed]="step > 2">
      <span>2</span>
      <div>Shipping</div>
    </div>
    <div class="line"></div>
    <div class="step" [class.active]="step === 3" [class.completed]="step > 3">
      <span>3</span>
      <div>Payment</div>
    </div>
    <div class="line"></div>
    <div class="step" [class.active]="step === 4">
      <span>4</span>
      <div>Review</div>
    </div>
  </div>

  <div class="checkout-main">
    <!-- FORM AREA -->
    <div class="checkout-form">
      <div *ngIf="step === 1">
        <h2>Customer Information</h2>
        <p class="form-desc">Please enter your contact details</p>
        <form>
          <div class="form-row">
            <input class="form-input" placeholder="First Name" [(ngModel)]="customer.firstname" name="firstname" required />
            <input class="form-input" placeholder="Last Name" [(ngModel)]="customer.lastname" name="lastname" required />
          </div>
          <input class="form-input" placeholder="Your Email" [(ngModel)]="customer.email" name="email" required />
          <input class="form-input" placeholder="Your Phone Number" [(ngModel)]="customer.phone" name="phone" />
          <button type="button" class="btn main-btn" (click)="nextStep()"
            [disabled]="!customer.firstname || !customer.lastname || !customer.email">
            Continue to Shipping
          </button>
        </form>
      </div>

      <div *ngIf="step === 2">
        <h2>Shipping Address</h2>
        <p class="form-desc">Where should we deliver your order?</p>
        <form>
          <input class="form-input" placeholder="Street Address" [(ngModel)]="shippingAddress.street" name="street" required />
          <input class="form-input" placeholder="Apartment, Suite, etc. (optional)" [(ngModel)]="shippingAddress.apartment" name="apartment" />
          <div class="form-row">
            <input class="form-input" placeholder="City" [(ngModel)]="shippingAddress.city" name="city" required />
            <input class="form-input" placeholder="State" [(ngModel)]="shippingAddress.state" name="state" />
            <input class="form-input" placeholder="ZIP Code" [(ngModel)]="shippingAddress.zip" name="zip" required />
          </div>
          <select class="form-input" [(ngModel)]="shippingAddress.country" name="country" required>
            <option value="">Select Country</option>
            <option value="France">France</option>
            <option value="USA">USA</option>
            <!-- Ajoute d'autres pays si besoin -->
          </select>
          <div class="form-actions">
            <button type="button" class="btn secondary-btn" (click)="prevStep()">Back to Information</button>
            <button type="button" class="btn main-btn" (click)="nextStep()"
              [disabled]="!shippingAddress.street || !shippingAddress.city || !shippingAddress.zip || !shippingAddress.country">
              Continue to Payment
            </button>
          </div>
        </form>
      </div>

      <div *ngIf="step === 3">
        <h2>Payment Method</h2>
        <p class="form-desc">Choose how you'd like to pay</p>
        <form>
          <div class="payment-options">
            <label>
              <input type="radio" [(ngModel)]="payment.method" value="card" name="paymethod" /> Credit / Debit Card
            </label>
            <label>
              <input type="radio" [(ngModel)]="payment.method" value="paypal" name="paymethod" /> PayPal
            </label>
            <label>
              <input type="radio" [(ngModel)]="payment.method" value="applepay" name="paymethod" /> Apple Pay
            </label>
          </div>
          <div *ngIf="payment.method === 'card'" class="card-form">
            <input class="form-input" placeholder="Card Number" [(ngModel)]="payment.cardNumber" name="cardNumber" />
            <div class="form-row">
              <input class="form-input" placeholder="Expiration Date" [(ngModel)]="payment.exp" name="exp" />
              <input class="form-input" placeholder="CVV" [(ngModel)]="payment.cvv" name="cvv" />
            </div>
            <input class="form-input" placeholder="Name on Card" [(ngModel)]="payment.name" name="name" />
          </div>
          <div class="form-actions">
            <button type="button" class="btn secondary-btn" (click)="prevStep()">Back to Shipping</button>
            <button type="button" class="btn main-btn" (click)="nextStep()">Review Order</button>
          </div>
        </form>
      </div>

      <div *ngIf="step === 4">
        <h2>Review Your Order</h2>
        <p class="form-desc">Please review your information before placing your order</p>
        <div class="review-block">
          <div class="review-section">
            <h4>Contact Information <a (click)="step=1">Edit</a></h4>
            <div>{{ customer.firstname }} {{ customer.lastname }}</div>
            <div>{{ customer.email }}</div>
            <div>{{ customer.phone }}</div>
          </div>
          <div class="review-section">
            <h4>Shipping Address <a (click)="step=2">Edit</a></h4>
            <div>{{ shippingAddress.street }} {{ shippingAddress.apartment }}</div>
            <div>{{ shippingAddress.city }}, {{ shippingAddress.state }} {{ shippingAddress.zip }}</div>
            <div>{{ shippingAddress.country }}</div>
          </div>
          <div class="review-section">
            <h4>Payment Method <a (click)="step=3">Edit</a></h4>
            <div *ngIf="payment.method==='card'">Card ending in {{ payment.cardNumber?.slice(-4) }}</div>
            <div *ngIf="payment.method==='paypal'">PayPal</div>
            <div *ngIf="payment.method==='applepay'">Apple Pay</div>
          </div>
        </div>
        <div class="form-actions">
          <button type="button" class="btn secondary-btn" (click)="prevStep()">Back to Payment</button>
          <button type="button" class="btn main-btn" (click)="placeOrder()">Place Order</button>
        </div>
        <div *ngIf="message" class="alert alert-success mt-3">{{message}}</div>
      </div>
    </div>

    <!-- ORDER SUMMARY AREA -->
    <aside class="order-summary">
      <h3>Order Summary</h3>
      <div *ngFor="let item of cartItems" class="summary-item">
        <img [src]="item.productImg" width="60" height="60" />
        <div class="summary-details">
          <div class="summary-title">{{item.productName}}</div>
          <div class="summary-meta">Size: {{item.productSize}}</div>
          <div class="summary-meta">{{item.qty}} Ã— ${{ item.pricePromo ?? item.productSizePrice | number:'1.2-2' }}</div>
        </div>
      </div>
      <hr>
      <div class="summary-row"><span>Subtotal</span><span>${{ subtotal | number:'1.2-2' }}</span></div>
      <div class="summary-row"><span>Shipping</span><span>${{ shipping | number:'1.2-2' }}</span></div>
      <div class="summary-row"><span>Tax</span><span>${{ tax | number:'1.2-2' }}</span></div>
      <div class="summary-row total"><span>Total</span><span>${{ total | number:'1.2-2' }}</span></div>
      <div class="promo-row">
        <input class="promo-input" placeholder="Promo Code" [(ngModel)]="promoCode" />
        <button class="btn promo-btn" (click)="applyPromo()">Apply</button>
      </div>
      <div class="secure-checkout">
        <span class="secure-icon">ðŸ”’</span> Secure Checkout
        <div class="payment-icons">
          <i class="material-icons">credit_card</i>
          <i class="material-icons">payment</i>
          <i class="material-icons">account_balance</i>
          <i class="material-icons">account_balance_wallet</i>
        </div>
      </div>
    </aside>
  </div>
</div>