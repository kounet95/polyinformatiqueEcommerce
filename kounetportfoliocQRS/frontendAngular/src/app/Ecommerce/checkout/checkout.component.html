<!--  Étapes visuelles -->
<div class="checkout-steps">
  <div [class.active]="step === 1">1<br />Information</div>
  <div [class.active]="step === 2">2<br />Shipping</div>
  <div [class.active]="step === 3">3<br />Payment</div>
  <div [class.active]="step === 4">4<br />Review</div>
</div>

<!--  Message global -->
<div *ngIf="message" class="checkout-message">
  {{ message }}
</div>

<!--  Étape 1 : Info client -->
<div *ngIf="step === 1">
  <h2>Customer Information</h2>
  <div><b>First Name:</b> {{ customer.firstname }}</div>
  <div><b>Last Name:</b> {{ customer.lastname }}</div>
  <div><b>Email:</b> {{ customer.email }}</div>
  <div><b>Phone:</b> {{ customer.phone }}</div>
  <button type="button" (click)="nextStep()">Continue to Shipping</button>
</div>

<!--  Étape 2 : Adresse -->
<div *ngIf="step === 2">
  <h2>Shipping Address</h2>
  <form>
    <input placeholder="Street Address" [(ngModel)]="shippingAddress.street" name="street" required />
    <input placeholder="Apartment, Suite, etc." [(ngModel)]="shippingAddress.apartment" name="apartment" />
    <input placeholder="City" [(ngModel)]="shippingAddress.city" name="city" required />
    <input placeholder="State" [(ngModel)]="shippingAddress.state" name="state" />
    <input placeholder="ZIP Code" [(ngModel)]="shippingAddress.zip" name="zip" required />
    <input placeholder="Country" [(ngModel)]="shippingAddress.country" name="country" required />

    <button type="button" (click)="prevStep()">Back to Information</button>
    <button type="button"
      [disabled]="!shippingAddress.street || !shippingAddress.city || !shippingAddress.zip || !shippingAddress.country || loading"
      (click)="nextStep()">Continue to Payment</button>
  </form>
</div>

<!--  Étape 3 : Méthode de paiement -->
<div *ngIf="step === 3">
  <h2>Payment Method</h2>
  <form>
    <div>
      <label>
        <input type="radio" [(ngModel)]="payment.method" value="card" name="paymethod" /> Credit / Debit Card
      </label>
    </div>

    <!--  Zone Stripe Elements reliée à ViewChild -->
    <div *ngIf="payment.method === 'card'">
      <div #cardElement id="card-element" style="border: 1px solid #ccc; padding: 12px;"></div>
    </div>

    <button type="button" (click)="prevStep()">Back to Shipping</button>
    <button type="button" [disabled]="loading" (click)="nextStep()">Review Order</button>
  </form>
</div>

<!--  Étape 4 : Review -->
<div *ngIf="step === 4">
  <h2>Review Your Order</h2>

  <div>
    <h4>Contact Information</h4>
    <div>{{ customer.firstname }} {{ customer.lastname }}</div>
    <div>{{ customer.email }}</div>
    <div>{{ customer.phone }}</div>
    <a (click)="step = 1">Edit</a>
  </div>

  <div>
    <h4>Shipping Address</h4>
    <div>{{ shippingAddress.street }} {{ shippingAddress.apartment }}</div>
    <div>{{ shippingAddress.city }}, {{ shippingAddress.state }} {{ shippingAddress.zip }}</div>
    <div>{{ shippingAddress.country }}</div>
    <a (click)="step = 2">Edit</a>
  </div>

  <div>
    <h4>Payment Method</h4>
    <div>Card Payment</div>
    <a (click)="step = 3">Edit</a>
  </div>

  <button (click)="prevStep()">Back to Payment</button>
  <button [disabled]="loading" (click)="placeOrder()">Pay Now</button>
</div>

<!-- Résumé panier -->
<aside class="order-summary">
  <h3>Order Summary</h3>
  <div *ngFor="let item of cartItems" class="summary-item">
    <img [src]="item.productImg" width="60" height="60" />
    <div>{{ item.productName }}</div>
    <div>Size: {{ item.productSize }}</div>
    <div>{{ item.qty }} × ${{ item.pricePromo ?? item.productSizePrice | number: '1.2-2' }}</div>
  </div>

  <hr />
  <div>Subtotal <span>${{ subtotal | number: '1.2-2' }}</span></div>
  <div>Shipping <span>${{ shipping | number: '1.2-2' }}</span></div>
  <div>Tax <span>${{ tax | number: '1.2-2' }}</span></div>
  <div>Total <span><b>${{ total | number: '1.2-2' }}</b></span></div>

  <input placeholder="Promo Code" [(ngModel)]="promoCode" />
  <button [disabled]="loading" (click)="applyPromo()">Apply</button>
</aside>
